app-id: ch.protonmail.protonmail-bridge
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "18.08"
command: protonmail-bridge
rename-desktop-file: ProtonMail_Bridge.desktop
rename-icon: ProtonMail_Bridge
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --device=dri
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.freedesktop.Notifications
modules:

  - name: libsecret
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/libsecret/-/archive/0.18.8/libsecret-0.18.8.tar.gz
        sha256: 33ee5dfd3556931b81d47111890c8b9c51093b4ced18e0e87f51c1769e24d43c
    config-opts:
      - --disable-manpages
      - --disable-gtk-doc
      - --disable-static
      - --disable-introspection
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/pkgconfig

  - name: protonmail-bridge
    buildsystem: simple
    build-commands:
      - ar x protonmail-bridge_1.2.0-1_amd64.deb
      - rm -f protonmail-bridge_1.2.0-1_amd64.deb
      - tar -xf data.tar.xz
      - rm -f data.tar.xz
      - mv usr/lib/* /app/lib/
      - mv usr/share/* /app/share/
      - rm -rf usr
      - ln -s /app/lib/protonmail/bridge/protonmail-bridge /app/bin/protonmail-bridge
      - install -Dp -m 644 /app/share/icons/protonmail/ProtonMail_Bridge.svg /app/share/icons/hicolor/scalable/apps/ProtonMail_Bridge.svg
      - install -Dp -m 644 ch.protonmail.protonmail-bridge.appdata.xml /app/share/metainfo/ch.protonmail.protonmail-bridge.appdata.xml
    sources:
      - type: file
        url: https://protonmail.com/download/beta/protonmail-bridge_1.2.0-1_amd64.deb
        sha256: 4150c290c681d2fe15e3e676aff13c413ea536c1a285c148fd532d34769c7bcb
      - type: file
        path: ch.protonmail.protonmail-bridge.appdata.xml
    cleanup:
      - /app/share/icons/protonmail
