id: ch.protonmail.protonmail-bridge
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "19.08"
command: protonmail-bridge
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --share=network
  - --device=dri
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=~/.local/state/protonmail/bridge
modules:
  - shared-modules/libsecret/libsecret.json
  - name: protonmail-bridge
    buildsystem: simple
    build-commands:
      - install -Dp -m 755 apply_extra /app/bin/apply_extra
      - install -Dp -m 755 protonmail-bridge /app/bin/protonmail-bridge
      - install -Dp -m 755 /usr/bin/ar /app/bin/ar
      - install -Dp -m 644 ch.protonmail.protonmail-bridge.desktop /app/share/applications/ch.protonmail.protonmail-bridge.desktop
      - install -Dp -m 644 ch.protonmail.protonmail-bridge.svg /app/share/icons/hicolor/scalable/apps/ch.protonmail.protonmail-bridge.svg
      - install -Dp -m 644 ch.protonmail.protonmail-bridge.appdata.xml /app/share/metainfo/ch.protonmail.protonmail-bridge.appdata.xml
      - ARCH_TRIPLE=$(gcc --print-multiarch) && install -Dp -m 644 /usr/lib/${ARCH_TRIPLE}/libbfd-*.so /app/lib
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - ar x protonmail-bridge.deb
          - rm -f protonmail-bridge.deb
          - tar -xf data.tar.xz
          - rm -f control.tar.xz data.tar.xz debian-binary _gpgorigin
          - mv usr/* .
          - rm -rf share bin usr
      - type: script
        dest-filename: protonmail-bridge
        commands:
          - 'exec "/app/extra/lib/protonmail/bridge/protonmail-bridge" "$@"'
      - type: extra-data
        filename: protonmail-bridge.deb
        size: 36829470
        installed-size: 144988118
        url: https://protonmail.com/download/beta/protonmail-bridge_1.2.5-1_amd64.deb
        sha256: 29039667303f5374df46993ad12989c8d7e540e6cacc8f9a0278503cf97bc322
      - type: file
        path: ch.protonmail.protonmail-bridge.svg
      - type: file
        path: ch.protonmail.protonmail-bridge.appdata.xml
      - type: file
        path: ch.protonmail.protonmail-bridge.desktop
